---
title: "Final Project"
author: "Ashlee"
date: "4/27/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.path = '../Output/')
```

# Introduction 
For my final project, I will be creating a phylogenetic tree based of the promoter region sequence, UVRAG along with twenty species that carry similar conservation of the same promoter region. 

# Libraries used 
```{r}
library(stats)
library(ade4)
library(ape)
library(adegenet)
library(phangorn)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(here)

```
Example using influenza data 

Load in the data using the function fasta2DNAbin() from adegenet package. Later converted to format used by phanogram package 
```{r}
dna <- fasta2DNAbin(file="http://adegenet.r-forge.r-project.org/files/usflu.fasta")

dna
```
Read in the annotation file 
```{r}
annot <- read.csv("http://adegenet.r-forge.r-project.org/files/usflu.annot.csv", header=TRUE, row.names=1)
annot
```
Using a Distance based method 
Step 1
```{r distanceflu}
D <- dist.dna(dna, model = "TN93")
length(D) #number of pairwise distances, computed as n(n-1)/2

temp <- as.data.frame(as.matrix(D))
table.paint(temp, cleg=0, clabel.row=.5, clabel.col=.5) #darker shades of gray mean a larger distance # you can also make cool color plots but they're much more complicated because they use the image() function
```
Step 2
```{r treeflu}
tre <- nj(D)
class(tre) #all trees created using {ape} package will be of class phylo

tre <- ladderize(tre)
tre # tells us what the tree will look like but doesn't show the actual construction

plot(tre, cex = 0.6)
title("A Simple NJ Tree")
```
```{r clusterflu}
# or 
h_cluster <- hclust(D, method = "average", members = NULL) # method = average is used for UPGMA, members can be equal to NULL or a vector with a length of size D
plot(h_cluster, cex = 0.6)
```
# Loading in Data 
```{r}
MSA2 <- read_csv(here("Data", "MSAs for UVRAG..csv"))
```

```{r FASTA}

#fasta2DNAbin(file, quiet=FALSE, chunkSize=10, snpOnly=FALSE)
#UVRAG <- fasta2DNAbin(file= here("FinalProject","Data","MSAs.fa", 
#                                  chunk = 10))

UVRAG1 <- fasta2DNAbin(file = here("Data", "MSAs.fas"))

UVRAG1
```

```{r}
#annot1 <- read_csv(here("Data", "MSAs for UVRAG *.csv", header=TRUE, row.names=1))
#annot1 <- read.csv("MSAs for UVRAG *.csv", header=TRUE, row.names=1)
#annot1
```


# Graphing 
```{r DistDNA}
U <- dist.dna(UVRAG1, model = "TN93")
length(U) #number of pairwise distances, computed as n(n-1)/2

temp1 <- as.data.frame(as.matrix(U))
#table.paint(temp1, cleg=1, clabel.row=1, clabel.col=1)
```


```{r UVRAGtree}
# Creating tree 
tree <- fastme.bal(U) # had to use fastme based off of fasta data 
class(tree) #all trees created using {ape} package will be of class phylo

tree <- ladderize(tree)
tree # tells us what the tree will look like but doesn't show the actual construction

plot(tree, cex = 0.6) 
title("Conservation of UVRAG Promoter")
```

```{r}
# or 

#cluster <- hclust(UR, method = "median", members = NULL) 
#plot(cluster, cex = 0.6)
```

